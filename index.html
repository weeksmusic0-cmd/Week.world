<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Week.world - Pro Edition PC</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    body{margin:0;font-family:'Segoe UI',Arial;overflow:hidden; background: #000;}
    #map{height:100vh; width:100%; cursor:crosshair; background: #222;}

    /* ANA MEN√ú TASARIMI */
    #main-menu {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100vh;
        background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.95)), url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&w=1920&q=80') center/cover;
        backdrop-filter: blur(10px);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: opacity 0.5s ease;
    }

    /* PANELLER (LOBƒ∞DE G√ñR√úN√úR) */
    #playtime-container {
        position: fixed; top: 25px; left: 25px;
        background: rgba(20, 25, 35, 0.9); padding: 12px 20px;
        border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 10001; color: white; backdrop-filter: blur(8px);
    }
    .playtime-label { font-size: 10px; text-transform: uppercase; color: #9da3af; font-weight: 800; }
    #playtime-display { font-size: 16px; font-weight: bold; color: #ffcc00; }

    #rank-container {
        position: fixed; top: 25px; right: 25px;
        background: rgba(20, 25, 35, 0.9); padding: 18px;
        border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 10001; color: white; min-width: 240px; backdrop-filter: blur(8px);
    }
    .rank-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    #rank-emoji { font-size: 36px; }
    #rank-name { font-size: 18px; font-weight: bold; }
    .win-bar { height: 14px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; display: flex; gap: 3px; padding: 2px; }
    .tick { flex: 1; background: rgba(255, 255, 255, 0.1); border-radius: 1px; }
    .tick.active { background: #ffcc00; }

    /* OYUN ƒ∞√áƒ∞ UI */
    .top-bar{ position:absolute;top:20px;left:0;width:100%; display:flex;justify-content:space-between;padding:0 30px;box-sizing:border-box;z-index:1000; pointer-events:none; }
    .city-box{background:#ffcc00;padding:12px 25px;border-radius:12px;font-weight:bold;pointer-events:auto; color:black; font-size: 20px;}
    .score-box{background:#00c853;color:white;padding:12px 25px;border-radius:12px;font-weight:bold;pointer-events:auto; min-width:140px; text-align:center;}
    
    .timer-box{ position:absolute;top:20px;left:50%;transform:translateX(-50%); background:#ff3d00;color:white;padding:12px 30px;border-radius:20px; font-size:22px;font-weight:bold;z-index:1000; min-width: 120px; text-align: center; }
    .distance-box{ position:absolute;top:85px;left:50%;transform:translateX(-50%); background:#2962ff;color:white;padding:10px 25px;border-radius:20px; font-weight:bold;z-index:1000;display:none; }
    
    .bottom-bar{ position:absolute;bottom:40px;left:50%;transform:translateX(-50%); z-index:1000; }
    button.guess-btn { padding:16px 60px;font-size:20px;border:none;border-radius:40px; background:#2962ff;color:white;cursor:pointer;font-weight:bold; box-shadow: 0 5px 15px rgba(0,0,0,0.4); }
    
    .result-box{ position:fixed;top:50%;left:50%;transform:translate(-50%,-50%); background:white;padding:40px;border-radius:24px; z-index:10000; display:none; text-align:center; width:400px; color: black; box-shadow: 0 0 50px rgba(0,0,0,0.5);}

    .modes-container { display:flex; gap:30px; margin-top: 40px; }
    .mode-card { width: 280px; height: 380px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; }
    .mode-card:hover { transform: translateY(-10px); background: rgba(255, 255, 255, 0.1); border-color: #ffcc00; }
    .mode-icon { font-size: 70px; margin-bottom: 20px; }
    .mode-card h3 { color: white; margin: 0; font-size: 1.5rem; }
    .mode-desc { color: #888; text-align: center; padding: 15px; font-size: 0.9rem; }
</style>
</head>
<body>

<div id="playtime-container">
    <div class="playtime-label">TOPLAM OYNAMA S√úRESƒ∞</div>
    <div id="playtime-display">0 Saat 0 Dakika</div>
</div>

<div id="rank-container">
    <div class="rank-header">
        <div id="rank-emoji">‚õìÔ∏è</div>
        <div class="rank-info">
            <div class="rank-label">Oyuncu Seviyesi</div>
            <div id="rank-name">Demir Madalya</div>
        </div>
    </div>
    <div id="progress-area"><div class="win-bar" id="win-ticks"></div></div>
</div>

<div id="main-menu">
    <h1 style="font-size:5rem; color:white; margin:0; letter-spacing: -2px;">Week.world</h1>
    <p style="color:white; opacity:0.6; font-size: 1.2rem;">D√ºnyayƒ± Tahmin Et | R√ºtbeni Y√ºkselt</p>
    <div class="modes-container">
        <div class="mode-card" onclick="startGame('speedrun')"><span class="mode-icon">‚è±Ô∏è</span><h3>Speedrun</h3><p class="mode-desc">500km'den uzaksan s√ºren resetlenmez!</p></div>
        <div class="mode-card" onclick="startGame('normal')"><span class="mode-icon">üåç</span><h3>D√ºnya Modu</h3><p class="mode-desc">Klasik deneyim. Hedef 25.000 puan.</p></div>
        <div class="mode-card" onclick="startGame('hardcore')"><span class="mode-icon">üß≠</span><h3>Hardcore</h3><p class="mode-desc">Hata payƒ± yok (500km sƒ±nƒ±r).</p></div>
    </div>
</div>

<div class="top-bar">
    <div class="city-box">Hedef: <span id="cityName">≈ûehir</span></div>
    <div class="score-box">Puan: <span id="score">0</span></div>
</div>
<div class="timer-box" id="timer">02:00</div>
<div class="distance-box" id="distanceBox"></div>
<div class="bottom-bar"><button class="guess-btn" id="guessBtn" onclick="makeGuess()">TAHMƒ∞N ET</button></div>
<div class="result-box" id="result"></div>
<div id="map"></div>

<script>
var cities = [
    ["ƒ∞stanbul",41.00,28.97],["Ankara",39.93,32.85],["ƒ∞zmir",38.41,27.12],["Antalya",36.89,30.71],
    ["Londra",51.50,-0.12],["Paris",48.85,2.35],["Berlin",52.52,13.40],["Roma",41.90,12.49],
    ["Madrid",40.41,-3.70],["Atina",37.98,23.72],["Moskova",55.75,37.61],["Amsterdam",52.36,4.89],
    ["Br√ºksel",50.85,4.35],["Viyana",48.20,16.37],["Prag",50.07,14.43],["Var≈üova",52.22,21.01],
    ["Tokyo",35.67,139.65],["Pekin",39.90,116.40],["Seul",37.56,126.97],["Dubai",25.20,55.27],
    ["Bak√º",40.40,49.86],["Baƒüdat",33.31,44.36],["Kahire",30.04,31.23],["Riyad",24.71,46.67],
    ["New York",40.71,-74.00],["Los Angeles",34.05,-118.24],["Miami",25.76,-80.19],["Toronto",43.65,-79.38],
    ["Rio de Janeiro",-22.90,-43.17],["Buenos Aires",-34.60,-58.38],["Sidney",-33.86,151.20],["Meksiko",19.43,-99.13],
    ["Reykjavik",64.13,-21.82],["Oslo",59.91,10.75],["Stokholm",59.32,18.06],["Helsinki",60.16,24.93],
    ["Lizbon",38.72,-9.13],["Budape≈üte",47.49,19.04],["B√ºkre≈ü",44.42,26.10],["Kiev",50.45,30.52],
    ["Dublin",53.34,-6.26],["Kopenhag",55.67,12.56],["Z√ºrih",47.37,8.54],["L√ºksemburg",49.61,6.13],
    ["Singapur",1.35,103.81],["Bangkok",13.75,100.50],["Mumbai",19.07,72.87],["Yeni Delhi",28.61,77.20],
    ["Jakarta",-6.20,106.84],["Manila",14.59,120.98],["Hanoi",21.02,105.83],["Ulan Batur",47.88,106.89],
    ["Astana",51.16,71.47],["Ta≈ükent",41.29,69.24],["Tiflis",41.71,44.78],["Tahran",35.68,51.38],
    ["Vancouver",49.28,-123.12],["Chicago",41.87,-87.62],["Santiago",-33.44,-70.66],["Lima",-12.04,-77.04],
    ["Bogota",4.71,-74.07],["Cape Town",-33.92,18.42],["Nairobi",-1.29,36.82],["Auckland",-36.84,174.76]
];

var map = L.map('map', {zoomControl: false, attributionControl: false, worldCopyJump: true}).setView([20,0], 3);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

var selectedCity, lastCityIndex=-1, guessMarker=null, realMarker=null, line=null;
var score=0, wins=parseInt(localStorage.getItem('weekWorldWins'))||0, totalSeconds=parseInt(localStorage.getItem('weekWorldPlaytime'))||0;
var timerInterval, nextRoundInterval, timeLeft=120, roundActive=false, currentMode='normal', lastGuessDist=0;

setInterval(() => {
    totalSeconds++; 
    localStorage.setItem('weekWorldPlaytime', totalSeconds);
    let h = Math.floor(totalSeconds/3600), m = Math.floor((totalSeconds%3600)/60);
    document.getElementById('playtime-display').innerText = `${h} Saat ${m} Dakika`;
}, 1000);

function updateRankUI() {
    const ticksContainer = document.getElementById('win-ticks');
    const nameDiv = document.getElementById('rank-name');
    const emojiDiv = document.getElementById('rank-emoji');
    let emoji, name;
    if (wins < 20) { emoji = "‚õìÔ∏è"; name = "Demir"; }
    else if (wins < 40) { emoji = "ü•à"; name = "G√ºm√º≈ü"; }
    else if (wins < 60) { emoji = "ü•á"; name = "Altƒ±n"; }
    else if (wins < 80) { emoji = "üíé"; name = "Elmas"; }
    else { emoji = "üëë"; name = "Efsane"; }
    emojiDiv.innerText = emoji; nameDiv.innerText = name;
    ticksContainer.innerHTML = '';
    for (let i = 0; i < 20; i++) {
        const tick = document.createElement('div');
        tick.className = 'tick' + (i < (wins % 20) ? ' active' : '');
        ticksContainer.appendChild(tick);
    }
}

function startGame(mode) {
    currentMode = mode;
    score = 0;
    lastGuessDist = 0;
    document.getElementById("score").innerText = "0";
    
    // MEN√ú VE PANELLERƒ∞ Gƒ∞ZLE
    document.getElementById('main-menu').style.opacity = '0';
    document.getElementById('playtime-container').style.display = 'none';
    document.getElementById('rank-container').style.display = 'none';

    setTimeout(() => { 
        document.getElementById('main-menu').style.display = 'none';
        map.invalidateSize();
        startRound(true);
    }, 500);
}

function startRound(forceResetTime = false) {
    if(score >= 25000) { showFinalScreen(); return; }
    if(guessMarker) map.removeLayer(guessMarker);
    if(realMarker) map.removeLayer(realMarker);
    if(line) map.removeLayer(line);
    document.getElementById("distanceBox").style.display="none";
    document.getElementById("guessBtn").style.display="block";
    
    if(currentMode === 'speedrun') {
        if(lastGuessDist < 500 || forceResetTime) timeLeft = 60;
    } else {
        timeLeft = 120;
    }

    document.getElementById("timer").style.display = (currentMode === 'hardcore') ? "none" : "block";
    let index;
    do{ index = Math.floor(Math.random()*cities.length); } while(index === lastCityIndex);
    lastCityIndex = index;
    selectedCity = cities[index];
    document.getElementById("cityName").innerText = selectedCity[0];
    roundActive = true;
    updateTimerUI();
    clearInterval(timerInterval);
    if(currentMode !== 'hardcore') {
        timerInterval = setInterval(() => {
            timeLeft--; updateTimerUI();
            if(timeLeft<=0) { clearInterval(timerInterval); gameOver("S√ºre Doldu!"); }
        }, 1000);
    }
}

function updateTimerUI() {
    let m = Math.floor(timeLeft/60), s = timeLeft%60;
    document.getElementById("timer").innerText = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

map.on('click', function(e) {
    if(!roundActive) return;
    if(guessMarker) map.removeLayer(guessMarker);
    guessMarker = L.marker(e.latlng).addTo(map);
});

function makeGuess() {
    if(!roundActive || !guessMarker) return;
    roundActive = false;
    clearInterval(timerInterval);
    document.getElementById("guessBtn").style.display = "none";
    let realPos = L.latLng(selectedCity[1], selectedCity[2]);
    let guessPos = guessMarker.getLatLng();
    realMarker = L.marker(realPos).addTo(map);
    line = L.polyline([guessPos, realPos], {color: 'red', weight: 3}).addTo(map);
    lastGuessDist = Math.round(map.distance(guessPos, realPos) / 1000);
    if(currentMode === 'hardcore' && lastGuessDist > 500) { gameOver("500km sƒ±nƒ±rƒ± a≈üƒ±ldƒ±!"); return; }
    let roundScore = Math.max(0, 5000 - (lastGuessDist * 5));
    score += roundScore;
    document.getElementById("score").innerText = score;
    document.getElementById("distanceBox").innerText = `${lastGuessDist} km mesafe | +${roundScore} Puan`;
    document.getElementById("distanceBox").style.display = "block";
    if(score >= 25000) setTimeout(showFinalScreen, 1500);
    else startCountdown();
}

function startCountdown() {
    let waitTime = 10;
    document.getElementById("timer").style.display = "block";
    document.getElementById("timer").innerText = "Sƒ±radaki: " + waitTime;
    clearInterval(nextRoundInterval);
    nextRoundInterval = setInterval(() => {
        waitTime--;
        document.getElementById("timer").innerText = "Sƒ±radaki: " + waitTime;
        if(waitTime <= 0) {
            clearInterval(nextRoundInterval);
            startRound(false);
        }
    }, 1000);
}

function gameOver(msg) {
    clearInterval(timerInterval);
    clearInterval(nextRoundInterval);
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `<h2>OYUN Bƒ∞TTƒ∞</h2><p>${msg}</p><button onclick="location.reload()" style="padding:15px 30px; cursor:pointer; background:#ffcc00; border:none; border-radius:10px; font-weight:bold;">LOBƒ∞YE D√ñN</button>`;
    // PANELLERƒ∞ TEKRAR G√ñSTERMEK ƒ∞√áƒ∞N location.reload() kullanƒ±yoruz zaten
}

function showFinalScreen() {
    wins++; 
    localStorage.setItem('weekWorldWins', wins);
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `<h2 style="color:green">TEBRƒ∞KLER!</h2><p>25.000 Puan Barajƒ±nƒ± Ge√ßtin!</p><button onclick="location.reload()" style="padding:15px 30px; cursor:pointer; background:#2962ff; color:white; border:none; border-radius:10px; font-weight:bold;">LOBƒ∞YE D√ñN</button>`;
}

updateRankUI();
</script>
</body>
</html>
